<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wenyi Fu ECE 5160 Fast Robots</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        header {
            background-color: #007BFF;
            color: #fff;
            text-align: center;
            padding: 20px;
            min-width: 910px;
        }

        nav {
            background-color: #333;
            overflow: hidden;
            text-align: center;
            min-width: 950px;
        }

        nav a {
            display: inline-block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        nav a:hover {
            background-color: #ddd;
            color: black;
        }

        nav.fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }

        /* Add styles for the extended bar */
        nav a:hover .extended-menu {
            display: block;
        }

        /* Adjust styles for the extended menu */
        .extended-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            background-color: #333;
            padding: 10px;
        }


        .name {
            background-color: #007BFF;
            color: #fff;
            text-align: center;
            font-size: 45px;
            font-weight: bold;
        }

        .main-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column; 
            width: 60%;
            min-width: 700px;
            
        }

        .main-body {
            display: flex;
            width: 100%;
        }

        section {
            min-width: 720px;
            max-width: 900px;
            margin: 10px auto;
            padding: 30px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        section a {
            text-decoration:underline;
            color: #3f99f9;
        }
        
        section p {
            font-size: 18px;
            color: black;
            line-height: 1.5;
            text-align: justify;
            margin-top: 0px;
            margin-bottom: 10px;
        }

        section p a:hover{
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        section ul {
            font-size: 18px;
            color: black;
            line-height: 1.5;
            text-align: justify;
            margin-top: 0px;
            margin-bottom: 30px;
        }

        section li {
            font-size: 18px;
            color: black;
            line-height: 1.5;
            text-align: justify;
            margin-top: 40px;
            margin-bottom: 10px;
        }

        section ul li {
            margin-top: 0px;
        }

        section h3,h4 {
            margin-top: 30px; /* Adjusted margin-top value */
            margin-bottom: 10px; /* Adjusted margin-bottom value */
        }

        h1 {
            color: #007BFF;
            font-weight: bold;
        }
        
        h2 {
            color: #007BFF;
            font-weight: bold;
            font-size: 35px;
        }

        .h2-text {
            font-size: 18px;
            color: black;
            line-height: 1.5;
            text-align: justify;
        }

        h3 {
            color: black;
            font-weight: bold;
            font-size: 25px;
        }

        h3 a {
            color: #007BFF;
            font-weight: bold;
            font-size: 20px;
            text-decoration: none;
        }

        h3 a:hover {
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        h4 {
            color: black;
            font-size: 20px;
            font-weight: bold;
        }

        .h4-text {
            font-size: 18px;
            text-align: justify;
        }

        h5 {
            color: black;
            font-size: 18px;
            font-weight: bold;
            overflow-wrap: break-word;
            margin-bottom: 10px;
        }

        .h5-text {
            font-size: 18px;
            text-align: justify;
        }

        .lab {
            margin-bottom: 20px;
        }


        footer {
            text-align: center;
            padding: 10px;
            background-color: #007BFF;
            color: #fff;
            min-width: 930px;
        }

        footer p {
            margin: 10px 40px; /* Add margin to the paragraphs for vertical separation */
        }

        .column {
            width: calc(100% - 5px);
        }
        
        .sidebar {
            margin: 10px 0;
            height: fit-content;
            width: 20%;
            max-width: 200px;
            min-width: 150px;
            position: relative;
            margin-right: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            color: #007BFF;
            font-weight: bold;
            font-size: 23px;
            text-align: center;
        }

        .sidebar img {
            width: 80%;
            max-width: 150px; /* Set a maximum width if needed */
            max-height: 150px;
            border-radius: 80%;
            object-fit: cover;
            position:relative;
        }

        .sidebar a {
            padding: 8px 16px;
            text-decoration: none;
            display: block;
            color: #007BFF;
            font-weight: bold;
        }

        .sidebar a:hover {
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .sidebar2 {
            margin: 10px 0;
            margin-left: 10px;
            height: fit-content;
            width: 20%;
            max-width: 200px;
            min-width: 150px;
            position: relative;
            margin-right: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            color: #007BFF;
            font-weight: bold;
            font-size: 23px;
            text-align: center;
        }

        .sidebar2.fixed {
            position: fixed;
            right: 20px; /* Adjust the distance from the right edge */
            top: 30px; /* Adjust the distance from the top */
        }

        .sidebar2 a {
            text-decoration: none;
            display: block;
            color: black;
            font-weight: bold;
            line-height: 1;
        }

        .sidebar2-heading {
            padding-left: 16px;
            text-decoration: none;
            display: block;
            color: black;
            font-weight: bold;
            font-size: 20px;
            line-height: 1;
        }

        .sidebar2-subheading {
            position:relative;
            font-size: 18px; 
            font-weight: normal; 
            padding-left: 25px; 
            padding-top: 0px;
            line-height: 0.5;
        }

        .sidebar2 a:hover {
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .sidebar2 div p a{
            text-decoration: none;
            display: block;
            color: black;
            line-height: 0.5;
            font-weight: normal;
        }

        .sidebar2 div p a:hover {
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .code-intext {
            font-family: 'Lucida Console', monospace;
            font-size: 16px;
            font-weight: bold;
        }

        .code-block {
            font-family:'Courier New', Courier, monospace;
            font-size: 18px;
            padding-left: 0px;
        }

        code {
            font-family:'Courier New', Courier, monospace;
            font-size: 18px;
        }

        section .img-container {
            width: 100%;
            margin-top: 5px;
            display: block;
            text-align: center;
        }

        section .img-container .img-intext {
            width: 100%;
            height: auto;
            display: inline-block;
            text-align: center;
            max-width: 700px;
        }

        .gist {
            width: calc(100% - 60px); /* Set the width to match the sections minus any margins or padding */
            margin: 0 auto; /* Center the box horizontally */
            box-sizing: border-box; /* Include padding and border in the width calculation */
        }

        .gist .blob-wrapper.data.type-text pre {
            white-space: wrap; /* Wrap text inside pre element */
        }

        .video-container {
            text-align: center;
            padding-left: 0px;
        }

        .eq {
            text-align: center;
            font-style: italic;
        }

    </style>
</head>
<body>

    <header>
        <div class="name">
            <p>ECE 5160: FAST ROBOTS</p>
            <p style="font-size: 35px;">Lab 10: Grid Localization using Bayes Filter</p>
        </div>
        <p style="font-size: 20px;">Wenyi Fu • ECE • wf223@cornell.edu</p>

    </header>

    <nav>
        <a href="index.html">Home</a>
        <a href="#intro">Introduction</a>
        <a href="#task">Prelab</a>
        <a href="#task">Lab Tasks</a>
        
    </nav>

   
    <div class="main-body">
        <div class="sidebar">
            <div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
                <img src="pics/wf223.jpg" alt="Wenyi Fu">
            </div>
            <p><a href="lab1.html">Lab 1</a></p>
            <p><a href="lab2.html">Lab 2</a></p>
            <p><a href="lab3.html">Lab 3</a></p>
            <p><a href="lab4.html">Lab 4</a></p>
            <p><a href="lab5.html">Lab 5</a></p>
            <p><a href="lab6.html">Lab 6</a></p>
            <p><a href="lab7.html">Lab 7</a></p>
            <p><a href="lab8.html">Lab 8</a></p>
            <p><a href="lab9.html">Lab 9</a></p>
            <p><a href="lab10.html">Lab 10</a></p>
            <p><a href="lab11.html">Lab 11</a></p>
            <p><a href="lab12.html">Lab 12</a></p>
        </div>
        
        
        <div class="main-section">

            <!-- INTRO -->
            <section id="intro">
                <h2>INTRODUCTION</h2>
                <p>The purpose of this lab is to implement grid localization using Bayes filter.</p>
                <p style="color: white;">--------------------------------------------------------------------------------------------------------------------------------------</p>
            </section>

            <section id="prelab">
                <h2>Prelab</h2>
                <h3>Background</h3>
                <p>The following figure shows the background information of the Bayes Filter. Additionally, according to the lab instructions, the Python code consists of several modules, which is Compute Control, Odometry Motion Model, Prediction Step, Sensor Model and Update Step.</p>
                <p>In essence, each cycle of the Bayes filter involves two main stages:</p>
                <div style="padding-left: 40px;">
                    <p>1. A prediction phase, where control input (movement) data is integrated.</p>
                    <p>2. An update phase, where observation (measurement) data is integrated.</p>
                </div>
                <p>During the prediction phase, uncertainty in the belief typically increases, while during the update phase, uncertainty decreases. The belief formed after the prediction phase is commonly known as the prior belief. For further details, please see <a href="https://fastrobotscornell.github.io/FastRobots/lectures/FastRobots-16-Markov_BayesFilter1.pdf">lectures 16</a> and <a href="https://fastrobotscornell.github.io/FastRobots/lectures/FastRobots-17-Motion_models.pdf">lecture 17</a>.</p>
                <div class="img-container">
                    <img class="img-intext" style="max-width: 500px;" src="pics/lab10/background.png" alt="">
                </div>
            </section>

            <!-- LAB TASKS -->
            <section id="task">
                <h2>LAB TASKS</h2>
                <p>Concerning the Implemetation of the Bayes Filter, we will follow the lab instruction downloaded from the website.
                <h3>Compute Control</h3>
                <p>The forecasting phase depends on control data obtained from the robot, acquired through the odometry motion model. Determining the robot's rotation involves trigonometric calculations based on its current and previous positions. In this stage, I followed the instructions in the comments and adjusted the rotation angles to ensure they fall within the range of (-180, +180) degrees.</p>
                <script src="https://gist.github.com/mavisfu/9a99f6729d820843a6871945198caca8.js"></script>

                <h3>Odometry Motion Model</h3>
                <p>In the next step, we wanted to obtain the probability that the robot would reach some current position <span class="code-intext">x'</span> given the previous position <span class="code-intext">x</span> and odometry values <span class="code-intext">u</span>. Therefore, we first extract the actual control values (representing rotations and translations needed to transition from the previous to the current position) by inputting the current and previous position parameters into our <span class="code-intext">compute_control</span> function. Then, employing a Gaussian distribution, we ascertain the probability that the robot has transitioned to the current position based on the anticipated movement derived from the instructed motion commands. This Gaussian distribution is centered around the expected robot motion computed from the odometry model, with a standard deviation determined by our confidence in the odometry model. Essentially, this function is akin to the probability <span class="code-intext">P(x'|x,u)</span>, signifying the probability that the robot has arrived at the current location <span class="code-intext">x'</span> given the previous location <span class="code-intext">x</span> and the movement commands <span class="code-intext">u</span>.
                <script src="https://gist.github.com/mavisfu/c623c9fd787597cd9da7de3f1c738c20.js"></script>


                <h3>Prediction Step</h3>
                <p>Now, equipped with all the required values, we are ready to execute the prediction step of the Bayes Filter. Hence, we looped through all the values. In addition, tp speed up the filter, all the grid hexes where the robot is unlikely to be could be ignored, with the threshold of <span class="code-intext">P(robot's prev pos at (x, y, theta)) >= 0.0001</span>.</p>
                <script src="https://gist.github.com/mavisfu/a17fabb4ab13e018ef6041d64d642166.js"></script>

                <h3>Sensor Model</h3>
                <p>In the latter stage of the Bayes Filter, we refined our predicted probability distribution with sensor measurements. To begin, we construct the <span class="code-intext">sensor_model()</span> function. This function operates on a pre-calculated array of true observations for a specific pose in the grid. It computes the probability of each sensor measurement based on the observations recorded by the robot's sensors post-movement. Utilizing the Gaussian function, with the true observation as the mean and <span class="code-intext">sensor_sigma</span> as the standard deviation (representing the sensor model's noise parameter), it generates an array comprising the probabilities. Essentially, this function assesses the likelihood that the sensor observations align with the true observations for a given pose in the grid.
                <script src="https://gist.github.com/mavisfu/c35b111f353383f8ad87d0617c2f84e1.js"></script>

                <h3>Update Step</h3>
                <p>To update the step, we nested three for loop to do the calculation so that the belief value of each potential position can be calculated through each iteration. Thus, the function program is listed below:</p>
                <script src="https://gist.github.com/mavisfu/26ee91d46cfa50084d4e35689ca2af15.js"></script>
                
                


                <h3>Results</h3>
                <p>Consequently, with all the above design and implementation, the following results can be obtained, where the red line represents for the odometry values, the green line stand for the true positions and the blue line indicates the belief values.</p>
                <div class="img-container">
                    <img class="img-intext" style="max-width: 800px;" src="pics/lab10/result1.png" alt="">
                </div>
                <div class="img-container">
                    <img class="img-intext" style="max-width: 400px;" src="pics/lab10/result2.png" alt="">
                    <img class="img-intext" style="max-width: 400px;" src="pics/lab10/result3.png" alt="">
                </div>

                <p style="margin-top: 40px;">This video display the process of the licalization:</p>
                <div class="video-container">
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/XOrmSdRgv3A?autoplay=1" frameborder="0" allowfullscreen></iframe>
                </div>

                <p style="margin-top: 40px;">Furthermore, the following is the data output during that process.</p>
                <script src="https://gist.github.com/mavisfu/9cbfcc1d73bb402c88f747c406a80835.js"></script>

            </section>

            

        </div>

    </div>

        


   

  

    <footer>
        <p>&copy; 2024 Wenyi Fu ECE 5160: Fast Robots</p>
        <p>E-mail: wf223@cornell.edu</p>
        
    </footer>

    <script>
        window.addEventListener('scroll', function() {
            var nav = document.querySelector('nav');
            var rect = nav.getBoundingClientRect();

            if (rect.top <= 0) {
                nav.classList.add('fixed');
            } else {
                nav.classList.remove('fixed');
            }
            if (window.scrollY <= 200) {
            nav.classList.remove('fixed');
        }
        });
        
    </script>

    


</body>
</html>
